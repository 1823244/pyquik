<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Time Series</title>
    <link href="layout.css" rel="stylesheet" type="text/css">
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../excanvas.min.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="jquery.js"></script>
    <script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="jquery.flot.selection.js"></script>
    <script language="javascript" type="text/javascript" src="datasource.js"></script>
 </head>
 <body>
    <div id="placeholder" style="width:100%;height:500px;padding:0;margin:0;"></div>
    <center><p id="choices">Show:</p></center>

<script type="text/javascript">
$(function () {
    var i = 0;
    $.each(datasets, function(key, val) {
        val.color = i;
        ++i;
    });
    
    var options = {
        selection: { mode: "x" }
    };

    var placeholder = $("#placeholder");

    function plotAccordingToChoices(ranges) {
        var data = [];

        choiceContainer.find("input:checked").each(function () {
            var key = $(this).attr("name");
            if (key && datasets[key])
                data.push(datasets[key]);
        });

        if (data.length > 0)
            if( !(ranges && "xaxis" in ranges) )
                $.plot(placeholder, data, options );
            else
                $.plot(placeholder, data,
                          $.extend(true, {}, options, {
                              xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to }
                          }));
     }

    // insert checkboxes 
    var choiceContainer = $("#choices");
    $.each(datasets, function(key, val) {
        choiceContainer.append('<input type="checkbox" name="' + key +
                               '" checked="checked" id="id' + key + '">' +
                               '<label for="id' + key + '">'
                                + val.label + '</label>');
    });
    choiceContainer.find("input").click(plotAccordingToChoices);
    placeholder.bind("plotselected", function (event, ranges) {
        plotAccordingToChoices(ranges);
    });

    plotAccordingToChoices();
});
</script>

 </body>
</html>
